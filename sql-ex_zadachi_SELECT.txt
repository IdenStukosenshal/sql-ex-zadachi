https://sql-ex.ru/learn_exercises.php


–í –æ—Å–Ω–æ–≤–Ω–æ–º —Ä–µ—à–µ–Ω–∏—è —Ä–∞—Å—Å—á–∏—Ç–∞–Ω—ã –Ω–∞ MySQL, –Ω–æ –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–ª—É—á–∞—è—Ö (–∫–æ–≥–¥–∞ —Å—Ç–æ–ª–±–µ—Ü –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è 'out')
–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞, —Ç–∞–∫–∂–µ –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –¥—Ä—É–≥–∏—Ö —Å–ª—É—á–∞—è—Ö    –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è MSSQL


‚Ññ13
–ù–∞–π–¥–∏—Ç–µ —Å—Ä–µ–¥–Ω—é—é —Å–∫–æ—Ä–æ—Å—Ç—å –ü–ö, –≤—ã–ø—É—â–µ–Ω–Ω—ã—Ö –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–º A.

SELECT AVG(speed) Avg_speed
  FROM pc
       INNER JOIN product p ON p.model = pc.model
 WHERE p.maker = 'A'

‚Ññ14
–ù–∞–π–¥–∏—Ç–µ –∫–ª–∞—Å—Å, –∏–º—è –∏ —Å—Ç—Ä–∞–Ω—É –¥–ª—è –∫–æ—Ä–∞–±–ª–µ–π –∏–∑ —Ç–∞–±–ª–∏—Ü—ã Ships, –∏–º–µ—é—â–∏—Ö –Ω–µ –º–µ–Ω–µ–µ 10 –æ—Ä—É–¥–∏–π.

SELECT c.class, s.name, c.country
  FROM Classes c
       INNER JOIN Ships s ON c.class = s.class
 WHERE c.numGuns >= 10

‚Ññ15
–ù–∞–π–¥–∏—Ç–µ —Ä–∞–∑–º–µ—Ä—ã –∂–µ—Å—Ç–∫–∏—Ö –¥–∏—Å–∫–æ–≤, —Å–æ–≤–ø–∞–¥–∞—é—â–∏—Ö —É –¥–≤—É—Ö –∏ –±–æ–ª–µ–µ PC. –í—ã–≤–µ—Å—Ç–∏: HD

SELECT hd
  FROM pc
 GROUP BY hd
HAVING count(*) >= 2


‚Ññ16
	–ù–∞–π–¥–∏—Ç–µ –ø–∞—Ä—ã –º–æ–¥–µ–ª–µ–π PC, –∏–º–µ—é—â–∏—Ö –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ —Å–∫–æ—Ä–æ—Å—Ç—å –∏ RAM. –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –∫–∞–∂–¥–∞—è –ø–∞—Ä–∞ —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑, —Ç.–µ. (i,j), –Ω–æ –Ω–µ (j,i),
–ü–æ—Ä—è–¥–æ–∫ –≤—ã–≤–æ–¥–∞: –º–æ–¥–µ–ª—å —Å –±–æ–ª—å—à–∏–º –Ω–æ–º–µ—Ä–æ–º, –º–æ–¥–µ–ª—å —Å –º–µ–Ω—å—à–∏–º –Ω–æ–º–µ—Ä–æ–º, —Å–∫–æ—Ä–æ—Å—Ç—å –∏ RAM.

SELECT DISTINCT p1.model, p2.model, p1.speed, p1.ram
  FROM pc p1, pc p2
 WHERE (p1.model > p2.model) AND (p1.speed = p2.speed) AND (p1.ram = p2.ram)


‚Ññ17
–ù–∞–π–¥–∏—Ç–µ –º–æ–¥–µ–ª–∏ –ü–ö-–±–ª–æ–∫–Ω–æ—Ç–æ–≤, —Å–∫–æ—Ä–æ—Å—Ç—å –∫–æ—Ç–æ—Ä—ã—Ö –º–µ–Ω—å—à–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∫–∞–∂–¥–æ–≥–æ –∏–∑ –ü–ö.
–í—ã–≤–µ—Å—Ç–∏: type, model, speed

SELECT DISTINCT p.type, l.model, l.speed
  FROM laptop l
       INNER JOIN product p ON l.model = p.model
 WHERE l.speed < ALL (
        SELECT speed FROM pc)

‚Ññ18
–ù–∞–π–¥–∏—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π —Å–∞–º—ã—Ö –¥–µ—à–µ–≤—ã—Ö —Ü–≤–µ—Ç–Ω—ã—Ö –ø—Ä–∏–Ω—Ç–µ—Ä–æ–≤. –í—ã–≤–µ—Å—Ç–∏: maker, price

SELECT DISTINCT pr.maker, p.price
  FROM printer p
       INNER JOIN product pr ON p.model = pr.model
 WHERE p.color = 'y' AND p.price = (
       SELECT MIN(price)
         FROM printer
        WHERE color = 'y')


‚Ññ19
–î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è, –∏–º–µ—é—â–µ–≥–æ –º–æ–¥–µ–ª–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ Laptop, –Ω–∞–π–¥–∏—Ç–µ —Å—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä —ç–∫—Ä–∞–Ω–∞ –≤—ã–ø—É—Å–∫–∞–µ–º—ã—Ö –∏–º 
–ü–ö-–±–ª–æ–∫–Ω–æ—Ç–æ–≤.
–í—ã–≤–µ—Å—Ç–∏: maker, —Å—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä —ç–∫—Ä–∞–Ω–∞ 
/*–∞–≤—Ç–æ—Ä —Ç–µ–∫—Å—Ç–∞ —Å–æ–≤—Å–µ–º –¥—É—Ä–∞–∫? –ó–∞–¥–∞—á–∞ –æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç–∞—è, –Ω–æ –ø–æ–¥–∞—á–∞ —Å–±–∏–≤–∞–µ—Ç —Å —Ç–æ–ª–∫—É*/

SELECT p.maker, AVG(l.screen)
  FROM laptop l
       INNER JOIN product p ON p.model = l.model
 GROUP BY p.maker

 
‚Ññ20
–ù–∞–π–¥–∏—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π, –≤—ã–ø—É—Å–∫–∞—é—â–∏—Ö –ø–æ –º–µ–Ω—å—à–µ–π –º–µ—Ä–µ —Ç—Ä–∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –º–æ–¥–µ–ª–∏ –ü–ö. –í—ã–≤–µ—Å—Ç–∏: Maker, —á–∏—Å–ª–æ –º–æ–¥–µ–ª–µ–π –ü–ö.

SELECT maker, COUNT(model)
  FROM product
 WHERE type = 'PC'
 GROUP BY maker
HAVING COUNT(model) >= 3


‚Ññ21
–ù–∞–π–¥–∏—Ç–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —Ü–µ–Ω—É –ü–ö, –≤—ã–ø—É—Å–∫–∞–µ–º—ã—Ö –∫–∞–∂–¥—ã–º –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–º, —É –∫–æ—Ç–æ—Ä–æ–≥–æ –µ—Å—Ç—å –º–æ–¥–µ–ª–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ PC.
–í—ã–≤–µ—Å—Ç–∏: maker, –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞.

SELECT pr.maker, MAX(pc.price) 
  FROM product pr
       INNER JOIN pc ON pr.model = pc.model
 GROUP BY pr.maker;


‚Ññ22
–î–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è —Å–∫–æ—Ä–æ—Å—Ç–∏ –ü–ö, –ø—Ä–µ–≤—ã—à–∞—é—â–µ–≥–æ 600 –ú–ì—Ü, –æ–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Å—Ä–µ–¥–Ω—é—é —Ü–µ–Ω—É –ü–ö —Å —Ç–∞–∫–æ–π –∂–µ —Å–∫–æ—Ä–æ—Å—Ç—å—é.
 –í—ã–≤–µ—Å—Ç–∏: speed, —Å—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞.

SELECT speed, AVG(price)
  FROM pc
 GROUP BY speed
HAVING speed > 600;


‚Ññ23
–ù–∞–π–¥–∏—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏–ª–∏ –±—ã –∫–∞–∫ –ü–ö —Å–æ —Å–∫–æ—Ä–æ—Å—Ç—å—é –Ω–µ –º–µ–Ω–µ–µ 750 –ú–ì—Ü,
 —Ç–∞–∫ –∏ –ü–ö-–±–ª–æ–∫–Ω–æ—Ç—ã —Å–æ —Å–∫–æ—Ä–æ—Å—Ç—å—é –Ω–µ –º–µ–Ω–µ–µ 750 –ú–ì—Ü.
–í—ã–≤–µ—Å—Ç–∏: Maker

SELECT maker
  FROM product pr
       INNER JOIN pc ON pc.model = pr.model
 WHERE speed >= 750
INTERSECT
SELECT maker
  FROM product pr
       INNER JOIN laptop l ON l.model = pr.model
 WHERE speed >= 750;





‚Ññ24  ( –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CTE)
–ü–µ—Ä–µ—á–∏—Å–ª–∏—Ç–µ –Ω–æ–º–µ—Ä–∞ –º–æ–¥–µ–ª–µ–π –ª—é–±—ã—Ö —Ç–∏–ø–æ–≤, –∏–º–µ—é—â–∏—Ö —Å–∞–º—É—é –≤—ã—Å–æ–∫—É—é —Ü–µ–Ω—É –ø–æ –≤—Å–µ–π –∏–º–µ—é—â–µ–π—Å—è –≤
 –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ü–∏–∏

WITH tmp AS(
SELECT model, price
  FROM laptop
 WHERE price = (SELECT MAX(price) FROM laptop)
UNION
SELECT model, price
  FROM pc
 WHERE price = (SELECT MAX(price) FROM pc)
UNION
SELECT model, price
  FROM printer
 WHERE price = (SELECT MAX(price) FROM printer))
SELECT model
  FROM tmp
 WHERE price = (SELECT MAX(price) FROM tmp)


‚Ññ25
–ù–∞–π–¥–∏—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π –ø—Ä–∏–Ω—Ç–µ—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–∏–∑–≤–æ–¥—è—Ç –ü–ö —Å –Ω–∞–∏–º–µ–Ω—å—à–∏–º –æ–±—ä–µ–º–æ–º RAM
 –∏ —Å —Å–∞–º—ã–º –±—ã—Å—Ç—Ä—ã–º –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–æ–º —Å—Ä–µ–¥–∏ –≤—Å–µ—Ö –ü–ö, –∏–º–µ—é—â–∏—Ö –Ω–∞–∏–º–µ–Ω—å—à–∏–π –æ–±—ä–µ–º RAM. –í—ã–≤–µ—Å—Ç–∏: Maker


SELECT DISTINCT maker
  FROM product
 WHERE type = 'Printer' AND maker IN
                 (
SELECT pr.maker
  FROM pc INNER JOIN product pr ON pr.model = pc.model
 WHERE pc.ram = (SELECT MIN(ram) FROM pc)
       AND
    pc.speed = (SELECT MAX(speed) FROM pc WHERE ram = (SELECT MIN(ram) FROM pc))
                  )




    –ï—â—ë –æ–¥–Ω–æ —Ä–µ—à–µ–Ω–∏–µ —Å CTE (–≤—ã–≥–ª—è–¥–∏—Ç —É–∂–∞—Å–Ω–æ, –Ω–µ –∑–Ω–∞—é –∑–∞—á–µ–º —è —ç—Ç–æ –ø—Ä–∏–¥—É–º–∞–ª)
WITH min_ram AS (SELECT MIN(ram) AS mr FROM pc),
max_speed AS (SELECT MAX(speed) AS ms FROM pc WHERE ram = (SELECT mr FROM min_ram)),
pc_makers AS (
  SELECT pr.maker AS mkr
  FROM pc
  INNER JOIN product pr ON pr.model = pc.model
  WHERE pc.ram = (SELECT mr FROM min_ram) AND pc.speed = (SELECT ms FROM max_speed)
             )
SELECT DISTINCT maker
FROM product
WHERE type = 'Printer' AND maker IN (SELECT mkr FROM pc_makers)


‚Ññ26
–ù–∞–π–¥–∏—Ç–µ —Å—Ä–µ–¥–Ω—é—é —Ü–µ–Ω—É –ü–ö –∏ –ü–ö-–±–ª–æ–∫–Ω–æ—Ç–æ–≤, –≤—ã–ø—É—â–µ–Ω–Ω—ã—Ö –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–º A
 (–ª–∞—Ç–∏–Ω—Å–∫–∞—è –±—É–∫–≤–∞). –í—ã–≤–µ—Å—Ç–∏: –æ–¥–Ω–∞ –æ–±—â–∞—è —Å—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞.

SELECT AVG(price)
  FROM (
SELECT price
  FROM laptop l INNER JOIN product pr ON pr.model = l.model
 WHERE pr.maker = 'A'
UNION ALL
SELECT price
  FROM pc INNER JOIN product pr ON pr.model = pc.model
 WHERE pr.maker = 'A') AS prices /*–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Å–µ–≤–¥–æ–Ω–∏–º–∞ –∑–¥–µ—Å—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ*/


‚Ññ27
–ù–∞–π–¥–∏—Ç–µ —Å—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä –¥–∏—Å–∫–∞ –ü–ö –∫–∞–∂–¥–æ–≥–æ –∏–∑ —Ç–µ—Ö –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–ø—É—Å–∫–∞—é—Ç –∏ –ø—Ä–∏–Ω—Ç–µ—Ä—ã.
 –í—ã–≤–µ—Å—Ç–∏: maker, —Å—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä HD

//–° —ç—Ç–æ–π –∑–∞–¥–∞—á–µ–π —á—Ç–æ-—Ç–æ –Ω–µ —Ç–∞–∫, –µ—Å–ª–∏ –¥–æ—Å—Ç–∞–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è—è —Ç–∞–±–ª–∏—Ü—É –ø—Ä–∏–Ω—Ç–µ—Ä–æ–≤
(–Ω–∞ –≤—ã—Ö–æ–¥–µ literally —Ç–æ—Ç –∂–µ —Å–∞–º—ã–π –Ω–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö), —ç—Ç–æ –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç üò§

SELECT pr.maker, AVG(pc.hd)
  FROM pc
       INNER JOIN product pr ON pr.model = pc.model
 WHERE pr.maker IN 
              (SELECT DISTINCT maker
                FROM product WHERE type = 'printer'
              )
 GROUP BY pr.maker


‚Ññ28
–ò—Å–ø–æ–ª—å–∑—É—è —Ç–∞–±–ª–∏—Ü—É Product, –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π, –≤—ã–ø—É—Å–∫–∞—é—â–∏—Ö –ø–æ –æ–¥–Ω–æ–π –º–æ–¥–µ–ª–∏.

SELECT COUNT(maker)
  FROM (
        SELECT maker
          FROM product
         GROUP BY maker
        HAVING COUNT(model) = 1
        ) result_set

‚Ññ29
–í –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–∏, —á—Ç–æ –ø—Ä–∏—Ö–æ–¥ –∏ —Ä–∞—Å—Ö–æ–¥ –¥–µ–Ω–µ–≥ –Ω–∞ –∫–∞–∂–¥–æ–º –ø—É–Ω–∫—Ç–µ –ø—Ä–∏–µ–º–∞ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –Ω–µ —á–∞—â–µ –æ–¥–Ω–æ–≥–æ —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å
[—Ç.–µ. –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á (–ø—É–Ω–∫—Ç, –¥–∞—Ç–∞)], –Ω–∞–ø–∏—Å–∞—Ç—å –∑–∞–ø—Ä–æ—Å —Å –≤—ã—Ö–æ–¥–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (–ø—É–Ω–∫—Ç, –¥–∞—Ç–∞, –ø—Ä–∏—Ö–æ–¥, —Ä–∞—Å—Ö–æ–¥).
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã Income_o –∏ Outcome_o.

–ê–±—Å–æ–ª—é—Ç–Ω–æ –Ω–µ–ø–æ–Ω—è—Ç–Ω–∞ –∑–∞–¥–∞—á–∞, —á—Ç–æ –Ω—É–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å? üò§

SELECT i.point, i.date, i.inc, o.out
  FROM Income_o i
       LEFT OUTER JOIN Outcome_o o ON i.point = o.point AND i.date = o.date
UNION
SELECT o.point, o.date, i.inc, o.out
  FROM Outcome_o o
       LEFT OUTER JOIN Income_o i ON i.point = o.point AND i.date = o.date


‚Ññ30
–í –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–∏, —á—Ç–æ –ø—Ä–∏—Ö–æ–¥ –∏ —Ä–∞—Å—Ö–æ–¥ –¥–µ–Ω–µ–≥ –Ω–∞ –∫–∞–∂–¥–æ–º –ø—É–Ω–∫—Ç–µ –ø—Ä–∏–µ–º–∞ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ —Ä–∞–∑
(–ø–µ—Ä–≤–∏—á–Ω—ã–º –∫–ª—é—á–æ–º –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö —è–≤–ª—è–µ—Ç—Å—è —Å—Ç–æ–ª–±–µ—Ü code),
  —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–ª—É—á–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É, –≤ –∫–æ—Ç–æ—Ä–æ–π –∫–∞–∂–¥–æ–º—É –ø—É–Ω–∫—Ç—É –∑–∞ –∫–∞–∂–¥—É—é –¥–∞—Ç—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π –±—É–¥–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞.
–í—ã–≤–æ–¥: point, date, —Å—É–º–º–∞—Ä–Ω—ã–π —Ä–∞—Å—Ö–æ–¥ –ø—É–Ω–∫—Ç–∞ –∑–∞ –¥–µ–Ω—å (out), —Å—É–º–º–∞—Ä–Ω—ã–π –ø—Ä–∏—Ö–æ–¥ –ø—É–Ω–∫—Ç–∞ –∑–∞ –¥–µ–Ω—å (inc).
  –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å—á–∏—Ç–∞—Ç—å –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º–∏ (NULL).


SELECT point, date, SUM(out), SUM(inc) FROM
    (SELECT point, date, SUM(out) out, null inc
      FROM Outcome
     GROUP BY point, date
    UNION
    SELECT point, date, null out, SUM(inc) inc
      FROM Income
     GROUP BY point, date) tabl
 GROUP BY point, date




SELECT point, date, SUM(out), SUM(inc)
  FROM (SELECT point, date, out, null inc FROM Outcome
        UNION ALL
        SELECT point, date, null out, inc FROM Income 
       ) rs
GROUP BY point, date


‚Ññ31
–î–ª—è –∫–ª–∞—Å—Å–æ–≤ –∫–æ—Ä–∞–±–ª–µ–π, –∫–∞–ª–∏–±—Ä –æ—Ä—É–¥–∏–π –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ –º–µ–Ω–µ–µ 16 –¥—é–π–º–æ–≤, —É–∫–∞–∂–∏—Ç–µ –∫–ª–∞—Å—Å –∏ —Å—Ç—Ä–∞–Ω—É.

SELECT class, country
  FROM classes
 WHERE bore >=16



‚Ññ32
–û–¥–Ω–æ–π –∏–∑ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ –∫–æ—Ä–∞–±–ª—è —è–≤–ª—è–µ—Ç—Å—è –ø–æ–ª–æ–≤–∏–Ω–∞ –∫—É–±–∞ –∫–∞–ª–∏–±—Ä–∞ –µ–≥–æ –≥–ª–∞–≤–Ω—ã—Ö –æ—Ä—É–¥–∏–π (mw).
–° —Ç–æ—á–Ω–æ—Å—Ç—å—é –¥–æ 2 –¥–µ—Å—è—Ç–∏—á–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Å—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ mw –¥–ª—è –∫–æ—Ä–∞–±–ª–µ–π –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω—ã,
—É –∫–æ—Ç–æ—Ä–æ–π –µ—Å—Ç—å –∫–æ—Ä–∞–±–ª–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.


SELECT country, CAST(AVG(POWER(bore, 3)/2) AS DECIMAL(6, 2))
  FROM(
      SELECT c.country, c.bore, s.name
        FROM classes c INNER JOIN ships s ON c.class = s.class
      UNION
      SELECT c.country, c.bore, o.ship
        FROM classes c INNER JOIN outcomes o ON o.ship = c.class
       WHERE o.ship NOT IN (SELECT name FROM ships)   /*–≤ outcomes –µ—Å—Ç—å –∫–æ—Ä–∞–±–ª–∏, –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –≤ ships, –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∏—Ö, –∏–∑–±–µ–≥–∞—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è*/
      ) rs
 GROUP BY country


‚Ññ33
–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä–∞–±–ª–∏, –ø–æ—Ç–æ–ø–ª–µ–Ω–Ω—ã–µ –≤ —Å—Ä–∞–∂–µ–Ω–∏—è—Ö –≤ –°–µ–≤–µ—Ä–Ω–æ–π –ê—Ç–ª–∞–Ω—Ç–∏–∫–µ (North Atlantic). –í—ã–≤–æ–¥: ship.

SELECT ship
  FROM outcomes o
 WHERE battle = 'North Atlantic' AND result = 'sunk'


‚Ññ34
–ü–æ –í–∞—à–∏–Ω–≥—Ç–æ–Ω—Å–∫–æ–º—É –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–º—É –¥–æ–≥–æ–≤–æ—Ä—É –æ—Ç –Ω–∞—á–∞–ª–∞ 1922 –≥. –∑–∞–ø—Ä–µ—â–∞–ª–æ—Å—å —Å—Ç—Ä–æ–∏—Ç—å –ª–∏–Ω–µ–π–Ω—ã–µ –∫–æ—Ä–∞–±–ª–∏
–≤–æ–¥–æ–∏–∑–º–µ—â–µ–Ω–∏–µ–º –±–æ–ª–µ–µ 35 —Ç—ã—Å.—Ç–æ–Ω–Ω. –£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä–∞–±–ª–∏, –Ω–∞—Ä—É—à–∏–≤—à–∏–µ —ç—Ç–æ—Ç –¥–æ–≥–æ–≤–æ—Ä
 (—É—á–∏—Ç—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –∫–æ—Ä–∞–±–ª–∏ c –∏–∑–≤–µ—Å—Ç–Ω—ã–º –≥–æ–¥–æ–º —Å–ø—É—Å–∫–∞ –Ω–∞ –≤–æ–¥—É). –í—ã–≤–µ—Å—Ç–∏ –Ω–∞–∑–≤–∞–Ω–∏—è –∫–æ—Ä–∞–±–ª–µ–π.

SELECT s.name
  FROM classes c INNER JOIN ships s ON c.class = s.class
 WHERE c.displacement > 35000 AND type = 'bb' AND launched >= 1922



35
–í —Ç–∞–±–ª–∏—Ü–µ Product –Ω–∞–π—Ç–∏ –º–æ–¥–µ–ª–∏, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ—Å—Ç–æ—è—Ç —Ç–æ–ª—å–∫–æ –∏–∑ —Ü–∏—Ñ—Ä –∏–ª–∏ —Ç–æ–ª—å–∫–æ –∏–∑ –ª–∞—Ç–∏–Ω—Å–∫–∏—Ö –±—É–∫–≤ (A-Z, –±–µ–∑ —É—á–µ—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞).
–í—ã–≤–æ–¥: –Ω–æ–º–µ—Ä –º–æ–¥–µ–ª–∏, —Ç–∏–ø –º–æ–¥–µ–ª–∏.

SELECT model, type
  FROM product
 WHERE  model ?? OR model ??

–í –∑–∞–¥–∞—á–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ—à–∏–±–∫–∞ –≤ —É—Å–ª–æ–≤–∏–∏, —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—Ç –µ–º—É + —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏ —Å regex



‚Ññ36
–ü–µ—Ä–µ—á–∏—Å–ª–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏—è –≥–æ–ª–æ–≤–Ω—ã—Ö –∫–æ—Ä–∞–±–ª–µ–π, –∏–º–µ—é—â–∏—Ö—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (—É—á–µ—Å—Ç—å –∫–æ—Ä–∞–±–ª–∏ –≤ Outcomes).

SELECT name FROM(

SELECT s.name
  FROM classes c
       INNER JOIN ships s ON c.class = s.class
UNION
SELECT o.ship
  FROM outcomes o
       INNER JOIN classes c ON c.class = o.ship
) t WHERE name IN (SELECT class FROM classes)



‚Ññ37
–ù–∞–π–¥–∏—Ç–µ –∫–ª–∞—Å—Å—ã, –≤ –∫–æ—Ç–æ—Ä—ã–µ –≤—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –∫–æ—Ä–∞–±–ª—å –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (—É—á–µ—Å—Ç—å —Ç–∞–∫–∂–µ –∫–æ—Ä–∞–±–ª–∏ –≤ Outcomes).
SELECT class
  FROM (SELECT c.class, s.name
          FROM classes c
               INNER JOIN ships s ON c.class = s.class
        UNION
        SELECT c.class, o.ship
          FROM outcomes o
               INNER JOIN classes c ON c.class = o.ship
      ) tbl
 GROUP BY class
HAVING COUNT(name) = 1



‚Ññ38
–ù–∞–π–¥–∏—Ç–µ —Å—Ç—Ä–∞–Ω—ã, –∏–º–µ–≤—à–∏–µ –∫–æ–≥–¥–∞-–ª–∏–±–æ –∫–ª–∞—Å—Å—ã –æ–±—ã—á–Ω—ã—Ö –±–æ–µ–≤—ã—Ö –∫–æ—Ä–∞–±–ª–µ–π
 ('bb') –∏ –∏–º–µ–≤—à–∏–µ –∫–æ–≥–¥–∞-–ª–∏–±–æ –∫–ª–∞—Å—Å—ã –∫—Ä–µ–π—Å–µ—Ä–æ–≤ ('bc').


SELECT country
   FROM classes
  WHERE type = 'bb'
INTERSECT
SELECT country
   FROM classes
  WHERE type = 'bc' /*–≤–æ–∑–º–æ–∂–Ω–æ –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å MySQL –∏–∑-–∑–∞ INTERSECT*/



SELECT country FROM
(SELECT country
   FROM classes
  WHERE type = 'bb'
UNION
 SELECT country
   FROM classes
  WHERE type = 'bc'
) tbl 
 GROUP BY country
HAVING COUNT(type) = 2

/*–ï—â—ë 1 –≤–∞—Ä–∏–∞–Ω—Ç —Ä–µ—à–µ–Ω–∏—è*/
SELECT t1.country
  FROM (SELECT DISTINCT country
         FROM classes
        WHERE type = 'bb') t1
  INNER JOIN (SELECT DISTINCT country
                FROM classes
               WHERE type = 'bc') t2
  ON t1.country = t2.country



‚Ññ39
–ù–∞–π–¥–∏—Ç–µ –∫–æ—Ä–∞–±–ª–∏, `—Å–æ—Ö—Ä–∞–Ω–∏–≤—à–∏–µ—Å—è –¥–ª—è –±—É–¥—É—â–∏—Ö —Å—Ä–∞–∂–µ–Ω–∏–π`;
—Ç.–µ. –≤—ã–≤–µ–¥–µ–Ω–Ω—ã–µ –∏–∑ —Å—Ç—Ä–æ—è –≤ –æ–¥–Ω–æ–π –±–∏—Ç–≤–µ (damaged), –æ–Ω–∏ —É—á–∞—Å—Ç–≤–æ–≤–∞–ª–∏ –≤ –¥—Ä—É–≥–æ–π, –ø—Ä–æ–∏–∑–æ—à–µ–¥—à–µ–π –ø–æ–∑–∂–µ.

SELECT DISTINCT o.ship
  FROM outcomes o INNER JOIN battles b ON o.battle = b.name
 WHERE o.result = 'damaged'
       AND EXISTS( SELECT ship
                     FROM outcomes o2 INNER JOIN battles b2 ON o2.battle = b2.name
                    WHERE o.ship = o2.ship AND b2.date > b.date
                 )



‚Ññ40
–ù–∞–π—Ç–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–ø—É—Å–∫–∞—é—Ç –±–æ–ª–µ–µ –æ–¥–Ω–æ–π –º–æ–¥–µ–ª–∏, –ø—Ä–∏ —ç—Ç–æ–º –≤—Å–µ –≤—ã–ø—É—Å–∫–∞–µ–º—ã–µ
–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–º –º–æ–¥–µ–ª–∏ —è–≤–ª—è—é—Ç—Å—è –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏ –æ–¥–Ω–æ–≥–æ —Ç–∏–ø–∞.
–í—ã–≤–µ—Å—Ç–∏: maker, type

SELECT maker, type
  FROM product
 GROUP BY maker
HAVING COUNT(DISTINCT model) > 1 AND COUNT(DISTINCT type) = 1



‚Ññ41
  –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è, —É –∫–æ—Ç–æ—Ä–æ–≥–æ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –º–æ–¥–µ–ª–∏ —Ö–æ—Ç—è –±—ã –≤ –æ–¥–Ω–æ–π –∏–∑ —Ç–∞–±–ª–∏—Ü PC, Laptop –∏–ª–∏ Printer,
–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —Ü–µ–Ω—É –Ω–∞ –µ–≥–æ –ø—Ä–æ–¥—É–∫—Ü–∏—é.
  –í—ã–≤–æ–¥: –∏–º—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è, –µ—Å–ª–∏ —Å—Ä–µ–¥–∏ —Ü–µ–Ω –Ω–∞ –ø—Ä–æ–¥—É–∫—Ü–∏—é –¥–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç NULL,
—Ç–æ –≤—ã–≤–æ–¥–∏—Ç—å –¥–ª—è —ç—Ç–æ–≥–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è NULL, –∏–Ω–∞—á–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —Ü–µ–Ω—É.

SELECT maker,
       CASE 
           WHEN SUM(CASE WHEN price IS NULL THEN 1 ELSE 0 END) > 0 THEN NULL
           ELSE MAX(price)
       END AS price
  FROM
(
SELECT pr.maker, l.price AS price
  FROM product pr INNER JOIN laptop l ON l.model = pr.model
UNION
SELECT pr.maker, pc.price AS price
  FROM product pr INNER JOIN pc ON pc.model = pr.model
UNION
SELECT pr.maker, pt.price AS price
  FROM product pr INNER JOIN printer pt ON pt.model = pr.model
) tbl
GROUP BY maker

‚Ññ42
–ù–∞–π–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∫–æ—Ä–∞–±–ª–µ–π, –ø–æ—Ç–æ–ø–ª–µ–Ω–Ω—ã—Ö –≤ —Å—Ä–∞–∂–µ–Ω–∏—è—Ö, –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å—Ä–∞–∂–µ–Ω–∏—è, –≤ –∫–æ—Ç–æ—Ä–æ–º –æ–Ω–∏ –±—ã–ª–∏ –ø–æ—Ç–æ–ø–ª–µ–Ω—ã.

SELECT DISTINCT ship, battle
  FROM outcomes
 WHERE result = 'sunk'



‚Ññ43
–£–∫–∞–∂–∏—Ç–µ —Å—Ä–∞–∂–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–∏–∑–æ—à–ª–∏ –≤ –≥–æ–¥—ã,
–Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—â–∏–µ –Ω–∏ —Å –æ–¥–Ω–∏–º –∏–∑ –≥–æ–¥–æ–≤ —Å–ø—É—Å–∫–∞ –∫–æ—Ä–∞–±–ª–µ–π –Ω–∞ –≤–æ–¥—É.

SELECT name
  FROM battles
 WHERE EXTRACT(YEAR FROM date) NOT IN(
       SELECT launched 
         FROM ships
        WHERE launched IS NOT NULL
                                     )




‚Ññ44
–ù–∞–π–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏—è –≤—Å–µ—Ö –∫–æ—Ä–∞–±–ª–µ–π –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö—Å—è —Å –±—É–∫–≤—ã R

SELECT name
  FROM
(
SELECT s.name
  FROM ships s
UNION
SELECT o.ship
  FROM outcomes o
) tbl
 WHERE name LIKE 'R%'

  –ò–õ–ò 

SELECT s.name AS name
  FROM ships s
 WHERE s.name LIKE 'R%'
UNION
SELECT o.ship AS name
  FROM outcomes o
 WHERE o.ship LIKE 'R%'


‚Ññ45
–ù–∞–π–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏—è –≤—Å–µ—Ö –∫–æ—Ä–∞–±–ª–µ–π –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, —Å–æ—Å—Ç–æ—è—â–∏–µ –∏–∑ —Ç—Ä–µ—Ö –∏ –±–æ–ª–µ–µ —Å–ª–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, King George V).
–°—á–∏—Ç–∞—Ç—å, —á—Ç–æ —Å–ª–æ–≤–∞ –≤ –Ω–∞–∑–≤–∞–Ω–∏—è—Ö —Ä–∞–∑–¥–µ–ª—è—é—Ç—Å—è –µ–¥–∏–Ω–∏—á–Ω—ã–º–∏ –ø—Ä–æ–±–µ–ª–∞–º–∏, –∏ –Ω–µ—Ç –∫–æ–Ω—Ü–µ–≤—ã—Ö –ø—Ä–æ–±–µ–ª–æ–≤.


SELECT name
  FROM ships
 WHERE name LIKE '_% _% _%'
UNION
SELECT ship AS name
  FROM outcomes
 WHERE ship LIKE '_% _% _%'



‚Ññ46
–î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–æ—Ä–∞–±–ª—è, —É—á–∞—Å—Ç–≤–æ–≤–∞–≤—à–µ–≥–æ –≤ —Å—Ä–∞–∂–µ–Ω–∏–∏ –ø—Ä–∏ –ì—É–∞–¥–∞–ª–∫–∞–Ω–∞–ª–µ (Guadalcanal),
 –≤—ã–≤–µ—Å—Ç–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ, –≤–æ–¥–æ–∏–∑–º–µ—â–µ–Ω–∏–µ –∏ —á–∏—Å–ª–æ –æ—Ä—É–¥–∏–π.

/*–ù–ï–ü–û–ù–Ø–¢–ù–û*/

SELECT o.ship, c.displacement, c.numGuns
  FROM outcomes o 
    LEFT OUTER JOIN ships s ON o.ship = s.name
    LEFT JOIN classes c ON c.class = s.class OR c.class = o.ship
 WHERE battle = 'Guadalcanal'



‚Ññ47
–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å—Ç—Ä–∞–Ω—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ—Ç–µ—Ä—è–ª–∏ –≤ —Å—Ä–∞–∂–µ–Ω–∏—è—Ö –≤—Å–µ —Å–≤–æ–∏ –∫–æ—Ä–∞–±–ª–∏.

/*–¢–∞–±–ª–∏—Ü–∞ —Å—Ç—Ä–∞–Ω –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –∫–æ—Ä–∞–±–ª–µ–π*/
SELECT c.country, s.name
  FROM ships s INNER JOIN classes c ON s.class=c.class
    UNION
SELECT c.country, o.ship 
  FROM outcomes o INNER JOIN classes c ON c.class=o.ship



/*?????*/
WITH country_name_tbl AS
(
SELECT c.country, s.name
  FROM ships s INNER JOIN classes c ON s.class=c.class
    UNION
SELECT c.country, o.ship 
  FROM outcomes o INNER JOIN classes c ON c.class=o.ship
)

SELECT DISTINCT country
  FROM country_name_tbl
 WHERE country NOT IN ( /*—ç—Ç–∞ —Ö–∏—Ç—Ä–∞—è –ª–æ–≥–∏—á–µ—Å–∫–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –æ—Ç—Å–µ–∏–≤–∞–µ—Ç –≤—Å–µ —Å—Ç—Ä–∞–Ω—ã, —É –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ –≤—Å–µ –∫–æ—Ä–∞–±–ª–∏ –ø–æ—Ç–æ–ø–ª–µ–Ω—ã*/
         SELECT country FROM country_name_tbl
         WHERE country_name_tbl.name NOT IN
            (
             SELECT ship FROM outcomes WHERE result = 'sunk'
            )                          
                      )



/*–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç*/
SELECT DISTINCT tbl.country, COUNT(tbl.name), SUM(CASE WHEN o.result = 'sunk' THEN 1 ELSE 0 END) 
  FROM 
(
SELECT c.country, s.name AS name
  FROM ships s INNER JOIN classes c ON s.class=c.class
    UNION
SELECT c.country, o.ship AS name
  FROM outcomes o INNER JOIN classes c ON c.class=o.ship
) tbl LEFT JOIN outcomes o ON tbl.name = o.ship

GROUP BY tbl.country
HAVING COUNT(tbl.name) = SUM(CASE WHEN o.result = 'sunk' THEN 1 ELSE 0 END) 



‚Ññ48
–ù–∞–π–¥–∏—Ç–µ –∫–ª–∞—Å—Å—ã –∫–æ—Ä–∞–±–ª–µ–π, –≤ –∫–æ—Ç–æ—Ä—ã—Ö —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∫–æ—Ä–∞–±–ª—å –±—ã–ª –ø–æ—Ç–æ–ø–ª–µ–Ω –≤ —Å—Ä–∞–∂–µ–Ω–∏–∏.



/*—Ç–∞–±–ª–∏—Ü–∞ –≤—Å–µ—Ö –∫–ª–∞—Å—Å–æ–≤ –∏ –∫–æ—Ä–∞–±–ª–µ–π*/
SELECT c.class, s.name
  FROM classes c
       INNER JOIN ships s ON c.class = s.class
UNION
SELECT c.class, o.ship
  FROM outcomes o
       INNER JOIN classes c ON c.class = o.ship




SELECT DISTINCT tbl.class
  FROM
(
SELECT c.class, s.name AS name
  FROM classes c
       INNER JOIN ships s ON c.class = s.class
UNION
SELECT c.class, o.ship AS name
  FROM outcomes o
       INNER JOIN classes c ON c.class = o.ship
) tbl INNER JOIN outcomes o ON o.ship = tbl.name
 WHERE o.result = 'sunk'


‚Ññ49
–ù–∞–π–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∫–æ—Ä–∞–±–ª–µ–π —Å –æ—Ä—É–¥–∏—è–º–∏ –∫–∞–ª–∏–±—Ä–∞ 16 –¥—é–π–º–æ–≤ (—É—á–µ—Å—Ç—å –∫–æ—Ä–∞–±–ª–∏ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã Outcomes).


SELECT s.name
  FROM classes c
       INNER JOIN ships s ON c.class = s.class
 WHERE c.bore = 16
UNION
SELECT o.ship
  FROM outcomes o
       INNER JOIN classes c ON c.class = o.ship
 WHERE c.bore = 16



‚Ññ50
–ù–∞–π–¥–∏—Ç–µ —Å—Ä–∞–∂–µ–Ω–∏—è, –≤ –∫–æ—Ç–æ—Ä—ã—Ö —É—á–∞—Å—Ç–≤–æ–≤–∞–ª–∏ –∫–æ—Ä–∞–±–ª–∏ –∫–ª–∞—Å—Å–∞ Kongo –∏–∑ —Ç–∞–±–ª–∏—Ü—ã Ships.

SELECT DISTINCT o.battle
  FROM classes c
       INNER JOIN ships s ON c.class = s.class
       INNER JOIN outcomes o ON o.ship = s.name
 WHERE c.class = 'Kongo'




‚Ññ51
–ù–∞–π–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∫–æ—Ä–∞–±–ª–µ–π, –∏–º–µ—é—â–∏—Ö –Ω–∞–∏–±–æ–ª—å—à–µ–µ —á–∏—Å–ª–æ –æ—Ä—É–¥–∏–π —Å—Ä–µ–¥–∏ –≤—Å–µ—Ö –∏–º–µ—é—â–∏—Ö—Å—è –∫–æ—Ä–∞–±–ª–µ–π
 —Ç–∞–∫–æ–≥–æ –∂–µ –≤–æ–¥–æ–∏–∑–º–µ—â–µ–Ω–∏—è (—É—á–µ—Å—Ç—å –∫–æ—Ä–∞–±–ª–∏ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã Outcomes).

INNER JOIN, OUTER JOIN, ALL/ANY

WITH source_set AS
(
SELECT s.name AS name, c.numGuns, c.displacement
  FROM classes c
       INNER JOIN ships s ON c.class = s.class
UNION
SELECT o.ship AS name, c.numGuns, c.displacement
  FROM outcomes o
       INNER JOIN classes c ON c.class = o.ship
),
group_set AS
(
SELECT displacement, MAX(numGuns) AS mx_guns
  FROM source_set
GROUP BY displacement
)

SELECT name
  FROM source_set s_s
       INNER JOIN group_set g_s ON s_s.displacement = g_s.displacement
 WHERE numGuns = mx_guns



‚Ññ52
–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏—è –≤—Å–µ—Ö –∫–æ—Ä–∞–±–ª–µ–π –∏–∑ —Ç–∞–±–ª–∏—Ü—ã Ships, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –ª–∏–Ω–µ–π–Ω—ã–º —è–ø–æ–Ω—Å–∫–∏–º –∫–æ—Ä–∞–±–ª–µ–º,
–∏–º–µ—é—â–∏–º —á–∏—Å–ª–æ –≥–ª–∞–≤–Ω—ã—Ö –æ—Ä—É–¥–∏–π –Ω–µ –º–µ–Ω–µ–µ –¥–µ–≤—è—Ç–∏, –∫–∞–ª–∏–±—Ä –æ—Ä—É–¥–∏–π –º–µ–Ω–µ–µ 19 –¥—é–π–º–æ–≤ –∏ –≤–æ–¥–æ–∏–∑–º–µ—â–µ–Ω–∏–µ –Ω–µ –±–æ–ª–µ–µ 65 —Ç—ã—Å.—Ç–æ–Ω–Ω

 –Ø–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
 –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è NULL –≤ —É—Å–ª–æ–≤–∏—è—Ö –ø–æ–∏—Å–∫–∞
 –û–ø–µ—Ä–∞—Ç–æ—Ä CASE
 –°–ª–æ–≤–∞ "–º–æ–≥—É—Ç –±—ã—Ç—å" –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞—é—Ç, —á—Ç–æ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∫–æ—Ä–∞–±–ª—è –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã (NULL)


WITH ships_set AS
(
SELECT s.name, 
       CASE
         WHEN c.country IS NULL THEN 'Japan' ELSE c.country
       END AS country,
       CASE
         WHEN c.type IS NULL THEN 'bb' ELSE c.type
       END AS type,
       CASE
         WHEN c.numGuns IS NULL THEN 9 ELSE c.numGuns
       END AS numGuns,
       CASE
         WHEN c.bore IS NULL THEN 18 ELSE c.bore
       END AS bore,
       CASE
         WHEN c.displacement IS NULL THEN 65000 ELSE c.displacement
       END AS displacement
  FROM ships s INNER JOIN classes c ON s.class = c.class
)
SELECT name
  FROM ships_set ss
 WHERE country = 'Japan' AND type = 'bb' AND numGuns >= 9 AND bore < 19 AND displacement <= 65000;


                  –î–ª—è MySQL —Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–¥–∞—á–∏ –ª–µ–≥—á–µ, —Ç–∞–∫ –∫–∞–∫ –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤—ã–≤–∞—Ç—å —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö
  –î–ª—è SQLServer –ø—Ä–∏—à–ª–æ—Å—å –±—ã —Å–Ω–∞—á–∞–ª–∞ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å –≤ DECIMAL, —Å—á–∏—Ç–∞—Ç—å —Å—Ä–µ–¥–Ω–µ–µ, –ø–æ—Ç–æ–º –æ–∫—Ä—É–≥–ª—è—Ç—å/–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤—ã–≤–∞—Ç—å –µ—â—ë —Ä–∞–∑
‚Ññ53  
–û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Å—Ä–µ–¥–Ω–µ–µ —á–∏—Å–ª–æ –æ—Ä—É–¥–∏–π –¥–ª—è –∫–ª–∞—Å—Å–æ–≤ –ª–∏–Ω–µ–π–Ω—ã—Ö –∫–æ—Ä–∞–±–ª–µ–π.
–ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é –¥–æ 2-—Ö –¥–µ—Å—è—Ç–∏—á–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤.

SELECT  ROUND(AVG(numGuns), 2)  AS avg_numguns
  FROM classes
 GROUP BY type
HAVING type = 'bb';


‚Ññ54
–° —Ç–æ—á–Ω–æ—Å—Ç—å—é –¥–æ 2-—Ö –¥–µ—Å—è—Ç–∏—á–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Å—Ä–µ–¥–Ω–µ–µ —á–∏—Å–ª–æ –æ—Ä—É–¥–∏–π
–≤—Å–µ—Ö –ª–∏–Ω–µ–π–Ω—ã—Ö –∫–æ—Ä–∞–±–ª–µ–π (—É—á–µ—Å—Ç—å –∫–æ—Ä–∞–±–ª–∏ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã Outcomes).


/*MySQL*/
WITH nmg_all AS
(
SELECT c.class, s.name, c.numGuns
  FROM classes c
       INNER JOIN ships s ON c.class = s.class
 WHERE c.type = 'bb'
UNION
SELECT c.class, o.ship, c.numGuns
  FROM outcomes o
       INNER JOIN classes c ON c.class = o.ship
 WHERE c.type = 'bb'
)
SELECT ROUND(AVG(numGuns), 2)
  FROM nmg_all



/*SQLServer*/
WITH nmg_all AS
(
SELECT c.class, s.name, c.numGuns
  FROM classes c
       INNER JOIN ships s ON c.class = s.class
 WHERE c.type = 'bb'
UNION
SELECT c.class, o.ship, c.numGuns
  FROM outcomes o
       INNER JOIN classes c ON c.class = o.ship
 WHERE c.type = 'bb'
)
SELECT CAST(AVG(CAST(numGuns AS DECIMAL(6, 2))) AS DECIMAL(6, 2))
  FROM nmg_all



‚Ññ55
–î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∞—Å—Å–∞ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –≥–æ–¥, –∫–æ–≥–¥–∞ –±—ã–ª —Å–ø—É—â–µ–Ω –Ω–∞ –≤–æ–¥—É –ø–µ—Ä–≤—ã–π –∫–æ—Ä–∞–±–ª—å —ç—Ç–æ–≥–æ –∫–ª–∞—Å—Å–∞.
–ï—Å–ª–∏ –≥–æ–¥ —Å–ø—É—Å–∫–∞ –Ω–∞ –≤–æ–¥—É –≥–æ–ª–æ–≤–Ω–æ–≥–æ –∫–æ—Ä–∞–±–ª—è –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω, –æ–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –≥–æ–¥ —Å–ø—É—Å–∫–∞ –Ω–∞ –≤–æ–¥—É
–∫–æ—Ä–∞–±–ª–µ–π —ç—Ç–æ–≥–æ –∫–ª–∞—Å—Å–∞. –í—ã–≤–µ—Å—Ç–∏: –∫–ª–∞—Å—Å, –≥–æ–¥

SELECT c.class, MIN(s.launched)
  FROM classes c LEFT JOIN ships s ON c.class = s.class
 GROUP BY c.class


‚Ññ56
–î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∞—Å—Å–∞ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —á–∏—Å–ª–æ –∫–æ—Ä–∞–±–ª–µ–π —ç—Ç–æ–≥–æ –∫–ª–∞—Å—Å–∞, –ø–æ—Ç–æ–ø–ª–µ–Ω–Ω—ã—Ö –≤ —Å—Ä–∞–∂–µ–Ω–∏—è—Ö.
–í—ã–≤–µ—Å—Ç–∏: –∫–ª–∞—Å—Å –∏ —á–∏—Å–ª–æ –ø–æ—Ç–æ–ø–ª–µ–Ω–Ω—ã—Ö –∫–æ—Ä–∞–±–ª–µ–π.


WITH r_s AS
(
SELECT c.class, s.name, o.result
  FROM classes c
       INNER JOIN ships s ON c.class = s.class
       LEFT JOIN outcomes o ON o.ship = s.name
UNION
SELECT c.class, o.ship AS name, o.result
  FROM classes c
       LEFT JOIN outcomes o ON c.class = o.ship
)
SELECT class, SUM(CASE WHEN result = 'sunk' THEN 1 ELSE 0 END)
  FROM r_s
 GROUP BY class


!!! –ù–ï –∑–∞–±—ã–≤–∞—Ç—å, —á—Ç–æ –º–æ–∂–Ω–æ –ø—Ä–∏–º–µ–Ω—è—Ç—å DISTINCT –ø–æ–¥–æ–±–Ω—ã–º –æ–±—Ä–∞–∑–æ–º: count(distinct name)  !!!


‚Ññ57
–î–ª—è –∫–ª–∞—Å—Å–æ–≤, –∏–º–µ—é—â–∏—Ö –ø–æ—Ç–µ—Ä–∏ –≤ –≤–∏–¥–µ –ø–æ—Ç–æ–ø–ª–µ–Ω–Ω—ã—Ö –∫–æ—Ä–∞–±–ª–µ–π –∏ –Ω–µ –º–µ–Ω–µ–µ 3 –∫–æ—Ä–∞–±–ª–µ–π –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, –≤—ã–≤–µ—Å—Ç–∏ –∏–º—è –∫–ª–∞—Å—Å–∞ –∏ —á–∏—Å–ª–æ –ø–æ—Ç–æ–ø–ª–µ–Ω–Ω—ã—Ö –∫–æ—Ä–∞–±–ª–µ–π.
 –Ø–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
 –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ GROUP BY
 –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ HAVING
 –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ
 –ü—Ä–µ–¥–∏–∫–∞—Ç IN

–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ª–µ–Ω–∏–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ, Mom'`'s spagetti, –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä–µ–¥–µ–ª–∞—Ç—å –ø–æ—Ç–æ–º?

WITH all_ships AS
(
SELECT c.class, s.name
  FROM classes c
       INNER JOIN ships s ON c.class = s.class
UNION
SELECT c.class, o.ship AS name
  FROM outcomes o
       INNER JOIN classes c ON c.class = o.ship
),
 count_ships AS
(
SELECT class, COUNT(name) AS count_names
  FROM all_ships
 GROUP BY class
),
 r_s AS
(
SELECT c.class, s.name, o.result
  FROM classes c
       INNER JOIN ships s ON c.class = s.class
       LEFT JOIN outcomes o ON o.ship = s.name
UNION
SELECT c.class, o.ship AS name, o.result
  FROM classes c
       LEFT JOIN outcomes o ON c.class = o.ship
), 
 sunk_ships AS
(
SELECT class, SUM(CASE WHEN result = 'sunk' THEN 1 ELSE 0 END) AS sunkd
  FROM r_s
 GROUP BY class
)

SELECT c_s.class, s_s.sunkd
  FROM count_ships c_s
       INNER JOIN sunk_ships s_s ON c_s.class = s_s.class
 WHERE c_s.count_names >= 3 AND s_s.sunkd != 0


‚Ññ58
–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –ø—Ä–æ–¥—É–∫—Ü–∏–∏ –∏ –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è –∏–∑ —Ç–∞–±–ª–∏—Ü—ã Product c —Ç–æ—á–Ω–æ—Å—Ç—å—é –¥–æ –¥–≤—É—Ö –¥–µ—Å—è—Ç–∏—á–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤ –Ω–∞–π—Ç–∏ –ø—Ä–æ—Ü–µ–Ω—Ç–Ω–æ–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–µ
 —á–∏—Å–ª–∞ –º–æ–¥–µ–ª–µ–π –¥–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ –¥–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è –∫ –æ–±—â–µ–º—É —á–∏—Å–ª—É –º–æ–¥–µ–ª–µ–π —ç—Ç–æ–≥–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è.
–í—ã–≤–æ–¥: maker, type, –ø—Ä–æ—Ü–µ–Ω—Ç–Ω–æ–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–µ —á–∏—Å–ª–∞ –º–æ–¥–µ–ª–µ–π –¥–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ –∫ –æ–±—â–µ–º—É —á–∏—Å–ª—É –º–æ–¥–µ–ª–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è

 –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Ç–æ–≥–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
 –ü—Ä–µ–æ–±—Ä–∞–∑o–≤–∞–Ω–∏–µ —Ç–∏–ø–æ–≤
 –Ø–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
 –î–µ–∫–∞—Ä—Ç–æ–≤–æ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
 –ö–æ—Ä—Ä–µ–ª–∏—Ä—É—é—â–∏–µ –ø–æ–¥–∑–∞–ø—Ä–æ—Å—ã
 –¶–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –¥–µ–ª–µ–Ω–∏–µ



/*CROSS JOIN*/
SELECT pr1.maker, pr2.type
  FROM product pr1, product pr2
 GROUP BY pr1.maker, pr2.type

/*CROSS JOIN*/
SELECT pr1.maker, pr2.type
  FROM product pr1 CROSS JOIN product pr2
 GROUP BY pr1.maker, pr2.type

/*–†–µ—à–µ–Ω–∏–µ –Ω–µ –º–æ—ë*/

SELECT
       pr1.maker,
       pr2.type,
       ROUND(
         (SELECT COUNT(pr.type)
            FROM product pr
           WHERE pr.maker = pr1.maker AND pr.type = pr2.type
         )
         /
         (SELECT COUNT(pr.type)
            FROM product pr
           WHERE pr.maker = pr1.maker
         )*100, 2) AS prc
  FROM product pr1 CROSS JOIN product pr2
 GROUP BY pr1.maker, pr2.type



‚Ññ59
–ü–æ—Å—á–∏—Ç–∞—Ç—å –æ—Å—Ç–∞—Ç–æ–∫ –¥–µ–Ω–µ–∂–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ –∫–∞–∂–¥–æ–º –ø—É–Ω–∫—Ç–µ –ø—Ä–∏–µ–º–∞ –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å—é
 –Ω–µ —á–∞—â–µ –æ–¥–Ω–æ–≥–æ —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å. –í—ã–≤–æ–¥: –ø—É–Ω–∫—Ç, –æ—Å—Ç–∞—Ç–æ–∫.


/*–ü—Ä–æ–±–ª–µ–º–∞ –≤ —Ç–æ–º, —á—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ "in" —Ç–∞–±–ª–∏—Ü–µ –±–æ–ª—å—à–µ –ø—É–Ω–∫—Ç–æ–≤, —á–µ–º –≤ "out" —Ç–∞–±–ª–∏—Ü–µ
(–Ω–µ —É—Å–ø–µ–ª–∏ –ø–æ—Ç—Ä–∞—Ç–∏—Ç—å –¥–µ–Ω—å–≥–∏)*/

WITH tbl1 AS
(
SELECT i.point, SUM(i.inc) d
  FROM income_o i
 GROUP BY i.point
), tbl2 AS
(
SELECT o.point, SUM(o.out) d
  FROM outcome_o o
GROUP BY o.point
)
SELECT tbl1.point, tbl1.d - (CASE WHEN tbl2.d IS NULL THEN 0 ELSE tbl2.d END)
  FROM tbl1 LEFT JOIN tbl2 ON tbl1.point = tbl2.point



WITH tbl1 AS
(
SELECT i.point, SUM(i.inc) d
  FROM income_o i
 GROUP BY i.point
UNION
SELECT o.point, -SUM(o.out) d
  FROM outcome_o o
GROUP BY o.point
)
SELECT point, SUM(d) 
  FROM tbl1
GROUP BY  point




‚Ññ60
–ü–æ—Å—á–∏—Ç–∞—Ç—å –æ—Å—Ç–∞—Ç–æ–∫ –¥–µ–Ω–µ–∂–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ –Ω–∞—á–∞–ª–æ –¥–Ω—è 15/04/01 –Ω–∞ –∫–∞–∂–¥–æ–º –ø—É–Ω–∫—Ç–µ –ø—Ä–∏–µ–º–∞ –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å—é
–Ω–µ —á–∞—â–µ –æ–¥–Ω–æ–≥–æ —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å.
 –í—ã–≤–æ–¥: –ø—É–Ω–∫—Ç, –æ—Å—Ç–∞—Ç–æ–∫.
–ó–∞–º–µ—á–∞–Ω–∏–µ. –ù–µ —É—á–∏—Ç—ã–≤–∞—Ç—å –ø—É–Ω–∫—Ç—ã, –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –¥–æ —É–∫–∞–∑–∞–Ω–Ω–æ–π –¥–∞—Ç—ã.


//–ü–æ—Ç—Ä–∞—Ç–∏–ª –æ–≥—Ä–æ–º–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –ø–æ–∏—Å–∫ –æ—à–∏–±–∫–∏, —á—Ç–æ–±—ã –ø–æ—Ç–æ–º —É–∑–Ω–∞—Ç—å, —á—Ç–æ
–Ω—É–∂–Ω–æ –¥–∞—Ç—É –ù–ï –≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ ü§¨

WITH tbl1 AS
(
SELECT i.point, SUM(i.inc) d
  FROM (SELECT * FROM income_o WHERE date < '2001-04-15') i
 GROUP BY i.point
), tbl2 AS
(
SELECT o.point, SUM(o.out) d
  FROM (SELECT * FROM outcome_o WHERE date < '2001-04-15') o
 GROUP BY o.point
)
SELECT tbl1.point, tbl1.d - (CASE WHEN tbl2.d IS NULL THEN 0 ELSE tbl2.d END)
  FROM tbl1 LEFT JOIN tbl2 ON tbl1.point = tbl2.point



‚Ññ61
–ü–æ—Å—á–∏—Ç–∞—Ç—å –æ—Å—Ç–∞—Ç–æ–∫ –¥–µ–Ω–µ–∂–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ –≤—Å–µ—Ö –ø—É–Ω–∫—Ç–∞—Ö –ø—Ä–∏–µ–º–∞ –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å—é –Ω–µ —á–∞—â–µ –æ–¥–Ω–æ–≥–æ —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å.


//–ü—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–æ –ø–æ—Ö–æ–∂–µ –æ—á–µ–Ω—å –Ω–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ
WITH tbl1 AS
(
SELECT i.point, SUM(i.inc) d
  FROM income_o i
 GROUP BY i.point
), tbl2 AS
(
SELECT o.point, SUM(o.out) d
  FROM outcome_o o
GROUP BY o.point
)
SELECT SUM(tbl1.d - (CASE WHEN tbl2.d IS NULL THEN 0 ELSE tbl2.d END))
  FROM tbl1 LEFT JOIN tbl2 ON tbl1.point = tbl2.point



–î—Ä—É–≥–æ–π –≤–∞—Ä–∏–∞–Ω—Ç

WITH tbl1 AS
(
SELECT SUM(inc) r FROM income_o 
UNION
SELECT -SUM(out) r FROM outcome_o
)

SELECT SUM(r)
  FROM tbl1



‚Ññ62
–ü–æ—Å—á–∏—Ç–∞—Ç—å –æ—Å—Ç–∞—Ç–æ–∫ –¥–µ–Ω–µ–∂–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ –≤—Å–µ—Ö –ø—É–Ω–∫—Ç–∞—Ö –ø—Ä–∏–µ–º–∞ –Ω–∞ –Ω–∞—á–∞–ª–æ –¥–Ω—è 15/04/01
 –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å—é –Ω–µ —á–∞—â–µ –æ–¥–Ω–æ–≥–æ —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å.

WITH tbl AS
(
SELECT SUM(inc) s FROM income_o WHERE date < '2001-04-15'
UNION 
SELECT -1 * SUM(out) s FROM outcome_o WHERE date < '2001-04-15'
)
SELECT SUM(s)
  FROM tbl

–ï—â—ë –≤–∞—Ä–∏–∞–Ω—Ç (–ª—É—á—à–µ):  

SELECT 
       (SELECT SUM(inc) s FROM income_o WHERE date < '2001-04-15')
        -
       (SELECT SUM(out) s FROM outcome_o WHERE date < '2001-04-15')
       AS result



‚Ññ63
–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∏–º–µ–Ω–∞ —Ä–∞–∑–Ω—ã—Ö –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤, –∫–æ–≥–¥–∞-–ª–∏–±–æ –ª–µ—Ç–µ–≤—à–∏—Ö –Ω–∞ –æ–¥–Ω–æ–º –∏ —Ç–æ–º –∂–µ –º–µ—Å—Ç–µ –±–æ–ª–µ–µ –æ–¥–Ω–æ–≥–æ —Ä–∞–∑–∞.

MySQL:

SELECT p.name
  FROM pass_in_trip pt INNER JOIN passenger p ON p.id_psg = pt.id_psg
 GROUP BY pt.id_psg
HAVING COUNT(pt.place) != COUNT(DISTINCT pt.place)

MSSQL:

WITH tbl AS
(
SELECT pt.id_psg 
  FROM pass_in_trip pt 
 GROUP BY pt.id_psg
HAVING COUNT(pt.place) != COUNT(DISTINCT pt.place)
)
SELECT p.name
  FROM tbl INNER JOIN passenger p ON p.id_psg = tbl.id_psg



‚Ññ64
–ò—Å–ø–æ–ª—å–∑—É—è —Ç–∞–±–ª–∏—Ü—ã Income –∏ Outcome, –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—É–Ω–∫—Ç–∞ –ø—Ä–∏–µ–º–∞ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –¥–Ω–∏,
 –∫–æ–≥–¥–∞ –±—ã–ª –ø—Ä–∏—Ö–æ–¥, –Ω–æ –Ω–µ –±—ã–ª–æ —Ä–∞—Å—Ö–æ–¥–∞ –∏ –Ω–∞–æ–±–æ—Ä–æ—Ç.
–í—ã–≤–æ–¥: –ø—É–Ω–∫—Ç, –¥–∞—Ç–∞, —Ç–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏ (inc/out), –¥–µ–Ω–µ–∂–Ω–∞—è —Å—É–º–º–∞ –∑–∞ –¥–µ–Ω—å.

MySQL:

WITH rs AS
(
SELECT i.point, i.date, 'inc' AS operation_type, i.inc AS money
  FROM income i LEFT JOIN outcome o ON i.date = o.date AND i.point = o.point
 WHERE o.out IS NULL
UNION ALL
SELECT o.point, o.date, 'out' AS operation_type, o.out AS money
  FROM income i RIGHT JOIN outcome o ON i.date = o.date AND i.point = o.point
 WHERE i.inc IS NULL
)

SELECT point, date, operation_type, SUM(money)
  FROM rs
 GROUP BY point, date

MSSQL:

WITH rs AS
(
SELECT i.point, i.date, 'inc' AS operation_type, i.inc AS money
  FROM income i LEFT JOIN outcome o ON i.date = o.date AND i.point = o.point
 WHERE o.out IS NULL
UNION ALL
SELECT o.point, o.date, 'out' AS operation_type, o.out AS money
  FROM income i RIGHT JOIN outcome o ON i.date = o.date AND i.point = o.point
 WHERE i.inc IS NULL
)

SELECT point, date, operation_type, SUM(money)
  FROM rs
 GROUP BY point, date, operation_type



========================================================================================================
–ï—â—ë –æ–¥–∏–Ω –≤–∞–∂–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏. –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–º—É –ø–æ—Ä—è–¥–∫—É –∑–Ω–∞—á–µ–Ω–∏–π –≤ —Å—Ç–æ–ª–±—Ü–µ.

–û—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –ø–æ—Ä—è–¥–∫–µ: PC, Laptop, Printer (—Å—Ç–æ–ª–±–µ—Ü type)

 MySQL: ORDER BY FIELD(type, 'PC', 'Laptop', 'Printer' )

 MSSQL: ORDER BY CASE type
                      WHEN 'PC' THEN 1
                      WHEN 'Laptop' THEN 2
                      WHEN 'Printer' THEN 3
                      ELSE 4
                 END
========================================================================================================


‚Ññ65
–ü—Ä–æ–Ω—É–º–µ—Ä–æ–≤–∞—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø–∞—Ä—ã {maker, type} –∏–∑ Product, —É–ø–æ—Ä—è–¥–æ—á–∏–≤ –∏—Ö —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:
- –∏–º—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è (maker) –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é;
- —Ç–∏–ø –ø—Ä–æ–¥—É–∫—Ç–∞ (type) –≤ –ø–æ—Ä—è–¥–∫–µ PC, Laptop, Printer.
–ï—Å–ª–∏ –Ω–µ–∫–∏–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å –≤—ã–ø—É—Å–∫–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∏–ø–æ–≤ –ø—Ä–æ–¥—É–∫—Ü–∏–∏, —Ç–æ –≤—ã–≤–æ–¥–∏—Ç—å –µ–≥–æ –∏–º—è —Ç–æ–ª—å–∫–æ –≤ –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–æ–∫–µ;
–æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –≠–¢–û–ì–û –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è –¥–æ–ª–∂–Ω—ã —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É —Å–∏–º–≤–æ–ª–æ–≤ ('').



–≠—Ç–æ –≤–µ—Ä–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ, ORDER BY –¥–æ–±–∞–≤–ª–µ–Ω –ø–æ—Ç–æ–º—É —á—Ç–æ –ø–æ—Ä—è–¥–æ–∫ —Å—Ç—Ä–æ–∫ –≤ CTE –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç—Å—è

MySQL:
WITH rs AS
(
SELECT DISTINCT maker, type
  FROM product
), rs_2 AS
( 
SELECT ROW_NUMBER() OVER(ORDER BY maker, FIELD(type, 'PC', 'Laptop', 'Printer' )) num, maker, type
  FROM rs
 ORDER BY maker, FIELD(type, 'PC', 'Laptop', 'Printer' )
), rs_3 AS
(
SELECT num, maker, type, ROW_NUMBER() OVER(PARTITION BY maker ORDER BY num, maker) AS number_maker
  FROM rs_2
 ORDER BY num, maker, FIELD(type, 'PC', 'Laptop', 'Printer' )
)
SELECT num, (CASE WHEN number_maker = 1 THEN maker ELSE '' END) maker, type
  FROM rs_3
 ORDER BY num



–ï—â—ë –æ–¥–∏–Ω –≤–∞—Ä–∏–∞–Ω—Ç(–ª—É—á—à–µ):

WITH rs1 AS
(
SELECT
       ROW_NUMBER() OVER(ORDER BY maker, FIELD(type, 'PC', 'Laptop', 'Printer' )) num,
       maker,
       type,
       ROW_NUMBER() OVER(PARTITION BY maker ORDER BY maker, FIELD(type, 'PC', 'Laptop', 'Printer' )) AS n_maker_part
  FROM ( SELECT DISTINCT maker, type FROM product) rs
 ORDER BY maker, FIELD(type, 'PC', 'Laptop', 'Printer' )
)
SELECT num, (CASE WHEN n_maker_part = 1 THEN maker ELSE '' END) maker, type
  FROM rs1



 –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è MSSQL:

WITH rs1 AS
(
SELECT
       ROW_NUMBER() OVER(ORDER BY maker, (CASE type
                                            WHEN 'PC' THEN 1
                                            WHEN 'Laptop' THEN 2
                                            WHEN 'Printer' THEN 3
                                            ELSE 4
                                       END)) num,
       maker,
       type,
       ROW_NUMBER() OVER(PARTITION BY maker ORDER BY maker, (CASE type
                                                              WHEN 'PC' THEN 1
                                                              WHEN 'Laptop' THEN 2
                                                              WHEN 'Printer' THEN 3                                                              
                                                            END)) AS n_maker_part
  FROM ( SELECT DISTINCT maker, type FROM product) rs
 ORDER BY maker, (CASE type
                      WHEN 'PC' THEN 1
                      WHEN 'Laptop' THEN 2
                      WHEN 'Printer' THEN 3                      
                 END)

)
SELECT num, (CASE WHEN n_maker_part = 1 THEN maker ELSE '' END) maker, type
  FROM rs1










